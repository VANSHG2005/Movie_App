<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <title>Movie App</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    /* Search Component Styles */
    .search-container {
      position: relative;
      display: flex;
      align-items: center;
    }

    .search-form {
      display: flex;
      align-items: center;
      position: relative;
    }

    .search-input {
      width: 0;
      opacity: 0;
      transition: all 0.3s ease;
      border: none;
      border-bottom: 2px solid #01b4e4 !important;
      background: transparent;
      color: white;
      padding: 0.375rem 0;
      margin-left: 0.5rem;
    }

    .search-input.active {
      width: 200px;
      opacity: 1;
      padding: 0.375rem 0.75rem;
    }

    .search-btn {
      color: white;
      padding: 0.375rem 0.75rem;
      background: none;
      border: none;
      cursor: pointer;
    }

    /* Custom Select Styles */
    .custom-select-wrapper {
      position: relative;
      width: 100px;
      opacity: 0;
      transition: all 0.3s ease;
      margin-left: 0.5rem;
    }

    .custom-select-wrapper.active {
      opacity: 1;
    }

    select.search-type {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background: transparent;
      border: none;
      padding: 0.375rem 1.75rem 0.375rem 0.75rem;
      margin: 0;
      width: 100%;
      font-family: inherit;
      font-size: inherit;
      cursor: pointer;
      outline: none;
      color: white;
      border-bottom: 2px solid #01b4e4 !important;
    }

    .custom-select-wrapper::after {
      content: "";
      position: absolute;
      top: 50%;
      right: 0.5rem;
      transform: translateY(-50%);
      width: 0.8em;
      height: 0.5em;
      background-color: white;
      clip-path: polygon(100% 0%, 0 0%, 50% 100%);
      pointer-events: none;
    }

    select.search-type option {
      background-color: #343a40;
      color: white;
    }

    /* Navbar alignment */
    .navbar-right-items {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Theme Styles */
    :root {
      --navbar-bg: #343a40;
    }

    [data-theme="dark"] {
      --navbar-bg: #121212;
    }

    /* Scrolling row styles */
    .scrolling-row {
      display: flex;
      overflow-x: auto;
      padding: 1rem 0;
      gap: 1rem;
      scrollbar-width: thin;
      scrollbar-color: #01b4e4 transparent;
    }

    .scrolling-card {
      flex: 0 0 auto;
      width: 200px;
      transition: transform 0.3s;
    }

    .scrolling-card:hover {
      transform: scale(1.05);
    }

    .scrolling-card img {
      width: 100%;
      border-radius: 8px;
    }

    .genre-section {
      margin-bottom: 3rem;
    }

    .genre-title {
      margin-bottom: 1.5rem;
      color: #01b4e4;
      font-weight: bold;
    }
    
    .auth-buttons {
      display: flex;
      gap: 0.5rem;
      margin-left: 1rem;
    }
    
    .google-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #4285F4;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 0.375rem 0.75rem;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    
    .google-btn:hover {
      background-color: #357ABD;
    }
    
    .google-icon {
      margin-right: 8px;
      font-size: 1.1rem;
    }
    
    .user-profile {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-left: 1rem;
    }
    
    .profile-pic {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
    }
    
    .dropdown-menu-end {
      right: 0;
      left: auto;
    }

  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4">
  <a class="navbar-brand" href="/">🎬 Movie App</a>

  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav me-auto">
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="moviesDropdown" role="button" data-bs-toggle="dropdown">
          Movies
        </a>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" href="/movies/popular">Popular</a></li>
          <li><a class="dropdown-item" href="/movies/now_playing">Now Playing</a></li>
          <li><a class="dropdown-item" href="/movies/upcoming">Upcoming</a></li>
          <li><a class="dropdown-item" href="/movies/top_rated">Top Rated</a></li>
        </ul>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="tvDropdown" role="button" data-bs-toggle="dropdown">
          TV Shows
        </a>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" href="/tv/popular">Popular</a></li>
          <li><a class="dropdown-item" href="/tv/airing_today">Airing Today</a></li>
          <li><a class="dropdown-item" href="/tv/on_the_air">On The Air</a></li>
          <li><a class="dropdown-item" href="/tv/top_rated">Top Rated</a></li>
        </ul>
      </li>

      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="genresDropdown" role="button" data-bs-toggle="dropdown">
          Genres
        </a>
        <ul class="dropdown-menu">
          <li><h6 class="dropdown-header">All Genres</h6></li>
          <li><a class="dropdown-item" href="/genre/movie/28">Action</a></li>
          <li><a class="dropdown-item" href="/genre/movie/35">Comedy</a></li>
          <li><a class="dropdown-item" href="/genre/movie/18">Drama</a></li>
          <li><a class="dropdown-item" href="/genre/movie/10749">Romance</a></li>
          <li><a class="dropdown-item" href="/genre/movie/27">Horror</a></li>
          <li><a class="dropdown-item" href="/genre/movie/878">Sci-Fi</a></li>
          <li><a class="dropdown-item" href="/genre/movie/53">Thriller</a></li>
          <li><a class="dropdown-item" href="/genre/movie/16">Animation</a></li>
          <li><a class="dropdown-item" href="/genre/movie/10751">Family</a></li>
          <li><a class="dropdown-item" href="/genre/movie/80">Crime</a></li>
          <li><a class="dropdown-item" href="/genre/movie/99">Documentary</a></li>
          <li><a class="dropdown-item" href="/genre/movie/14">Fantasy</a></li>
          <li><a class="dropdown-item" href="/genre/movie/10752">War</a></li>
          <li><a class="dropdown-item" href="/genre/movie/37">Western</a></li>
        </ul>
      </li>

    </ul>
  </div>

  <div class="navbar-right-items">
    <div class="search-container">
      <form class="search-form" method="POST" action="/recommend">
        <input class="form-control search-input" type="text" name="movie" placeholder="Search for movies or TV shows...">
        <div class="custom-select-wrapper">
          <select class="form-select search-type" name="content_type">
            <option value="movie">Movies</option>
            <option value="tv">TV Shows</option>
          </select>
        </div>
        <button class="btn btn-link search-btn" type="button">
          <i class="fas fa-search"></i>
        </button>
      </form>
    </div>
    <!-- <button class="btn btn-outline-warning" id="themeToggle">🌙</button> -->
  </div>

  <!-- Auth Buttons - shown when user is not logged in -->
    {% if not current_user.is_authenticated %}
    <div class="auth-buttons">
      <a href="{{ url_for('login') }}" class="btn btn-outline-light">Log In</a>
      <a href="/signup" class="btn btn-primary">Sign Up</a>
      <!-- <button class="google-btn" onclick="handleGoogleAuth()">
        <i class="fab fa-google google-icon"></i>
        Google
      </button> -->
    </div>
    {% else %}
    <!-- User Profile - shown when user is logged in -->
    <div class="user-profile dropdown">
      <a href="#" class="text-white text-decoration-none dropdown-toggle" id="dropdownUser1" data-bs-toggle="dropdown" aria-expanded="false">
        {{ current_user.name }}
      </a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownUser1">
        <li><a class="dropdown-item" href="{{ url_for('profile') }}">Profile</a></li>
        <li><a class="dropdown-item" href="/watchlist">Watchlist</a></li>
        <li><hr class="dropdown-divider"></li>
        <li><a class="dropdown-item" href="/logout">Sign out</a></li>
      </ul>
    </div>
    {% endif %}
    
    <button class="btn btn-outline-warning" id="themeToggle">🌙</button>
  </div>


</nav>

<div class="container mt-4">
  {% block content %}
    <!-- This will be replaced by genre-specific content when a genre is selected -->
    {% if genre_name %}
    <div class="genre-page">
      <h1 class="mb-4">{{ genre_name }} Content</h1>
      
      <div class="genre-section">
        <h2 class="genre-title">Movies</h2>
        <div class="scrolling-row">
          {% for movie in movies %}
          <div class="scrolling-card">
            <a href="/movie/{{ movie.id }}">
              <img src="https://image.tmdb.org/t/p/w500{{ movie.poster_path }}" alt="{{ movie.title }}" class="img-fluid">
              <h5 class="mt-2">{{ movie.title }}</h5>
            </a>
          </div>
          {% endfor %}
        </div>
      </div>
      
      <div class="genre-section">
        <h2 class="genre-title">TV Shows</h2>
        <div class="scrolling-row">
          {% for tv in tv_shows %}
          <div class="scrolling-card">
            <a href="/tv/{{ tv.id }}">
              <img src="https://image.tmdb.org/t/p/w500{{ tv.poster_path }}" alt="{{ tv.name }}" class="img-fluid">
              <h5 class="mt-2">{{ tv.name }}</h5>
            </a>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
    {% endif %}
  {% endblock %}
</div>

<script>
  // Search toggle functionality
  const searchBtn = document.querySelector('.search-btn');
  const searchInput = document.querySelector('.search-input');
  const searchTypeWrapper = document.querySelector('.custom-select-wrapper');
  const searchForm = document.querySelector('.search-form');

  searchBtn.addEventListener('click', (e) => {
    e.preventDefault();
    e.stopPropagation();
    
    // Toggle visibility
    const isActive = searchInput.classList.toggle('active');
    searchTypeWrapper.classList.toggle('active', isActive);
    
    if (isActive) {
      searchInput.focus();
    }
  });

  // Close search when clicking outside
  document.addEventListener('click', (e) => {
    if (!searchForm.contains(e.target)) {
      searchInput.classList.remove('active');
      searchTypeWrapper.classList.remove('active');
    }
  });

  // Theme toggle functionality
  const toggle = document.getElementById('themeToggle');
  const html = document.documentElement;
  
  function setTheme(theme) {
    html.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    toggle.innerHTML = theme === 'dark' ? '☀️' : '🌙';
    document.body.style.backgroundColor = theme === 'dark' ? '#121212' : '#ffffff';
    document.body.style.color = theme === 'dark' ? '#f5f5f5' : '#333333';
  }
  
  toggle.addEventListener('click', () => {
    const newTheme = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
    setTheme(newTheme);
  });
  
  // Initialize theme
  const savedTheme = localStorage.getItem('theme') || 'light';
  setTheme(savedTheme);

  // Google OAuth function
  function handleGoogleAuth() {
    // You'll need to replace with your actual OAuth client ID
    const clientId = 'YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com';
    const redirectUri = encodeURIComponent('http://yourdomain.com/auth/google/callback');
    const scope = encodeURIComponent('profile email');
    const authUrl = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=code&scope=${scope}&access_type=offline`;
    
    window.location.href = authUrl;
  }
  
  // Alternatively, you can use Google's client library for more control
  function initGoogleAuth() {
    gapi.load('auth2', function() {
      gapi.auth2.init({
        client_id: 'YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com',
        scope: 'profile email'
      }).then(function(auth2) {
        console.log('Google Auth initialized');
      });
    });
  }

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Load Google API client -->
<script src="https://apis.google.com/js/platform.js?onload=initGoogleAuth" async defer></script>


  
</body>
</html>